# 이메일 레포트 기능 흐름도

```
┌─────────────────────────────────────────────────────────────────────┐
│                     사용자 웹 인터페이스                                │
│  Gmail 계정, 비밀번호, 기간 입력 → [이메일 처리 시작] 버튼 클릭          │
└─────────────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────────────┐
│                    Flask 서버 (/process)                             │
│  1. 입력 유효성 검사                                                   │
│  2. Gmail 연결 테스트                                                 │
│  3. 이메일 수 계산 (빠른 스캔)                                          │
└─────────────────────────────────────────────────────────────────────┘
                              │
                    ┌─────────┴─────────┐
                    │                   │
                    ▼                   ▼
        ┌───────────────────┐  ┌──────────────────────┐
        │  시작 알림 이메일  │  │  즉시 응답 반환       │
        │  발송 (SMTP)      │  │  { background: true } │
        └───────────────────┘  └──────────────────────┘
                    │                   │
                    │                   ▼
                    │          ┌──────────────────────┐
                    │          │  사용자가 브라우저   │
                    │          │  닫아도 OK!          │
                    │          └──────────────────────┘
                    │
                    ▼
        ┌───────────────────────────┐
        │  이메일 내용:              │
        │  • 기간: 2025-01-01 ~     │
        │         2025-01-31        │
        │  • 대상 이메일: 50건       │
        │  • 예상 시간: 1분 40초     │
        └───────────────────────────┘
                    │
                    ▼
        ┌─────────────────────────────────────┐
        │  백그라운드 스레드 (daemon)          │
        │  ┌─────────────────────────────┐   │
        │  │ 1. Gmail 이메일 수집        │   │
        │  │ 2. 필터링 (키워드, 학번)     │   │
        │  │ 3. 이메일 쌍 매칭            │   │
        │  │ 4. Excel 파일 생성          │   │
        │  └─────────────────────────────┘   │
        └─────────────────────────────────────┘
                    │
                    ▼
        ┌───────────────────────────┐
        │  Excel 파일 생성           │
        │  consultation_report_      │
        │  20250106_143022.xlsx      │
        └───────────────────────────┘
                    │
                    ▼
        ┌───────────────────────────┐
        │  완료 알림 이메일 발송     │
        │  (SMTP with attachment)   │
        └───────────────────────────┘
                    │
                    ▼
        ┌───────────────────────────┐
        │  이메일 내용:              │
        │  • 처리 완료: 15건         │
        │  • HTML 결과 테이블        │
        │  • Excel 파일 첨부         │
        └───────────────────────────┘
                    │
                    ▼
        ┌───────────────────────────┐
        │  임시 파일 정리            │
        │  Excel 파일 삭제           │
        └───────────────────────────┘
                    │
                    ▼
        ┌───────────────────────────┐
        │  처리 완료!                │
        │  사용자 이메일 수신함에    │
        │  결과 도착                 │
        └───────────────────────────┘
```

## 주요 특징

### 비동기 처리
- 사용자 요청 후 즉시 응답 반환
- 실제 처리는 백그라운드에서 진행
- 웹 브라우저를 닫아도 처리 계속

### 이메일 알림
1. **시작 알림**: 처리 시작 즉시 발송
   - 처리할 이메일 수
   - 예상 완료 시간
   
2. **완료 알림**: 처리 완료 시 발송
   - 결과 요약
   - Excel 파일 첨부

### 보안
- Gmail 앱 비밀번호 사용
- SSL/TLS 암호화 통신
- 임시 파일 자동 삭제

## 시간 계산

예상 완료 시간 = 이메일 수 × 2초

예시:
- 10개 이메일 → 20초
- 50개 이메일 → 1분 40초
- 100개 이메일 → 3분 20초
- 200개 이메일 → 6분 40초

## 에러 처리

```
┌─────────────────────┐
│  인증 실패?         │
└─────────────────────┘
         │ Yes
         ▼
┌─────────────────────┐
│  AUTH_FAILED 반환   │
│  앱 비밀번호 안내   │
└─────────────────────┘

┌─────────────────────┐
│  이메일 없음?       │
└─────────────────────┘
         │ Yes
         ▼
┌─────────────────────┐
│  시작 알림만 발송   │
│  완료 알림은 X      │
└─────────────────────┘

┌─────────────────────┐
│  SMTP 발송 실패?    │
└─────────────────────┘
         │ Yes
         ▼
┌─────────────────────┐
│  로그 기록          │
│  처리는 계속 진행   │
└─────────────────────┘
```
